
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Hoare Logic &#8212; Logical Foundations of Computing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"tex": {"macros": {"Set": ["{\\sf Set}", 0], "Qu": ["{\\Omega}", 0], "QuCat": ["{\\Omega\\text{-cat}}", 0], "One": ["{\\mathbb{1}}", 0], "yo": ["\u3088", 0], "bigsqcap": ["\\sqcap", 0]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/appendix-hoare-logic';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to Create a Jupyter Book" href="how-to-create-a-jupyter-book.html" />
    <link rel="prev" title="Resources on Puzzles" href="appendix-puzzles.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Logical Foundations of Computing</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Logics and Their Software Tools</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="0-logic.html">Introduction to Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="1-propositional-logic.html">Propositional Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="2-satsolving.html">SAT solving with MiniSat</a></li>
<li class="toctree-l1"><a class="reference internal" href="3-logic-programming.html">Logic Programming with Prolog</a></li>
<li class="toctree-l1"><a class="reference internal" href="4-constraint-solving.html">Constraint Programming with MiniZinc</a></li>
<li class="toctree-l1"><a class="reference internal" href="5-smt-solving.html">SMT Solving and Z3</a></li>
<li class="toctree-l1"><a class="reference internal" href="6-modal-logic.html">Modal Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="7-temporal-logic.html">Temporal Logic with Spin</a></li>
<li class="toctree-l1"><a class="reference internal" href="8-epistemic-logic.html">Epistemic Logic with SMCDEL</a></li>
<li class="toctree-l1"><a class="reference internal" href="9-hoare-logic.html">Hoare Logic with Dafny</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-higher-order-logic.html">Higher-Order Logic with Isabelle/HOL</a></li>
<li class="toctree-l1"><a class="reference internal" href="11-dependent-types.html">Dependent Type Theory with Lean</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="appendix-puzzles.html">Resources on Puzzles</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Hoare Logic</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix: On Jupyter Books</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="how-to-create-a-jupyter-book.html">How to Create a Jupyter Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="notebooks.html">Content with notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LEAP-at-Chapman/CPSC-510-Logical-Foundations-of-Computing" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LEAP-at-Chapman/CPSC-510-Logical-Foundations-of-Computing/issues/new?title=Issue%20on%20page%20%2Fcontent/appendix-hoare-logic.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/appendix-hoare-logic.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Hoare Logic</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preconditions-postconditions">Preconditions … Postconditions …</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#program-variables-vs-mathematical-variables">Program Variables vs Mathematical Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rules-in-detail">The Rules in Detail</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#while-loop">While-loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-hoare-logic-compositional">Making Hoare Logic Compositional</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sequential-composition">Sequential Composition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assignment">Assignment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-then-else">If-then-else</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework">Homework</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-exercises">Further Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-and-outlook">Summary and Outlook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Hoare Logic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#structured-programming">Structured Programming</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#historical-references">Historical References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further Reading</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formal-verification">Formal Verification</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="hoare-logic">
<h1>Hoare Logic<a class="headerlink" href="#hoare-logic" title="Link to this heading">#</a></h1>
<p>“The most  important property of a program is whether it accomplishes the intentions of its user. If the intentions can be described rigorously by making assertions about the values of variables at the end of the execution of the program, then the techniques described in this paper may be used to prove the correcteness of the program.”</p>
<p>Hoare. <a class="reference external" href="http://extras.springer.com/2002/978-3-642-63970-8/DVD3/rom/pdf/Hoare_hist.pdf">An axiomatic basis for computer programming</a>. Communications of the ACM. 12 (10): 576–580, 1969.</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>In Programming Languages there is an important circle of ideas including <a class="reference external" href="https://en.wikipedia.org/wiki/Hoare_logic">Hoare logic</a> and Dijkstra’s <a class="reference external" href="https://en.wikipedia.org/wiki/Predicate_transformer_semantics">predicate transformer semantics</a>, Kozen’s <a class="reference external" href="https://en.wikipedia.org/wiki/Kleene_algebra">Kleene algebra</a> and Pratt’s <a class="reference external" href="https://en.wikipedia.org/wiki/Dynamic_logic_(modal_logic)">Dynamic logic</a>, O’Hearn and Reynolds’s <a class="reference external" href="https://en.wikipedia.org/wiki/Separation_logic">Separation logic</a> and many more methods, techniques, tools, etc.</p>
<p>This line of research grew out of the methodology of <strong>structured programming</strong>, which is something that every programmer learns today right from the start, but was a novel concept around 1970. I postpone a discussion of this to the conclusions.</p>
<p>Here, we will just give some of the basic ideas and illustrate them with an important technique of proving the correctness of while programs.</p>
<p>Therefore, an alternative title would be</p>
<div class="math notranslate nohighlight">
\[
\textbf{Correctness of While Programs}
\]</div>
<p>The technique is based on a refinement of the method of invariants. Thus, another possible title is</p>
<div class="math notranslate nohighlight">
\[
\textbf{Invariants for Program Correctness}
\]</div>
<p>These ideas have various ramifications in programming and software engineering.</p>
<ul class="simple">
<li><p>Preconditions, Postconditions, and Invariants are useful at all levels of programming and software development: Every function, procedure, method, component, <a class="reference external" href="https://en.wikipedia.org/wiki/Application_programming_interface">API</a>, etc has</p>
<ul>
<li><p>preconditions that are required from the user to guarantee correct performance</p></li>
<li><p>postconsitions that are guarantees to the user</p></li>
<li><p>invariants that are guaranteed to hold after execution if they held before execution</p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Design_by_contract">Design by contract</a> is a software engineering method build on these ideas.</p></li>
<li><p>Check out the <a class="reference external" href="https://en.wikipedia.org/wiki/Design_by_contract#Language_support">list of programming languages</a> supporting these ideas.</p></li>
<li><p>Assume/guarantee or rely/guarantee is an important technique in the development of concurrent programs</p></li>
</ul>
<p><strong>Table of Contents</strong>:</p>
<ul class="simple">
<li><p><a class="reference internal" href="9-hoare-logic.html"><span class="std std-doc">Summary of the Rules of Hoare Logic</span></a></p></li>
<li><p>Introductory Example</p></li>
<li><p>Preconditions and Postconditions</p></li>
<li><p>Program Variables vs Mathematical Variables</p></li>
<li><p>The Rules in Detail</p></li>
</ul>
</section>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<p>Consider the following program, see also <a class="reference download internal" download="" href="../_downloads/ef9b58bcac37a0c17456a10925186a4a/HL-example-1.dfy"><span class="xref download myst">HL-example-1.dfy</span></a>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">do</span> <span class="n">z</span><span class="o">:=</span><span class="n">z</span><span class="o">+</span><span class="n">y</span><span class="p">;</span>  <span class="n">x</span><span class="o">:=</span> <span class="n">x</span><span class="o">-</span><span class="mi">1</span> <span class="n">done</span>
</pre></div>
</div>
<p>Here are some questions we may ask.</p>
<ul class="simple">
<li><p>Does this program  terminate?</p></li>
<li><p>What does the program calculate?</p></li>
<li><p>Does this program calculate <code class="docutils literal notranslate"><span class="pre">x*y</span></code> in the variable <code class="docutils literal notranslate"><span class="pre">z</span></code>?</p></li>
</ul>
<p>It will  depend on the value of <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">z</span></code> before executing the program.</p>
<p>This program will terminate and yield <code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">=</span> <span class="pre">x*y</span></code>  at the end if <code class="docutils literal notranslate"><span class="pre">x</span></code> is non-negative and  <code class="docutils literal notranslate"><span class="pre">z==0</span></code> at the start.</p>
<p><strong>Activity:</strong> Find an invariant for the while loop.</p>
<p>Answer. <a class="footnote-reference brackets" href="#invariantwhile2" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a><a class="footnote-reference brackets" href="#invariantwhile" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a></p>
</section>
<section id="preconditions-postconditions">
<h2>Preconditions … Postconditions …<a class="headerlink" href="#preconditions-postconditions" title="Link to this heading">#</a></h2>
<p>As the example shows part of the difficulty lies in having a reliable notation that allows us to track change through a program and making statements (such as <code class="docutils literal notranslate"><span class="pre">z</span> <span class="pre">==</span> <span class="pre">x*y</span></code> ) about its properties.</p>
<p>The first important idea is that we want express that certain assumptions are satisfied before executing the program (preconditions)  and properties that we then know after the execution of the program (postconditions)</p>
<p>If <span class="math notranslate nohighlight">\(\mathtt S\)</span> is a program (“S” as in “Sequence of Statements”) then we write</p>
<div class="math notranslate nohighlight">
\[
\{P\}\; \mathtt S\;\{Q\}
\]</div>
<p>A predicate that holds before the execution of the program is  called  a <em><strong>precondition</strong></em>  and a predicate that holds after  a <em><strong>postcondition</strong></em>. If the precondition is met before execution,  the program  establishes the postcondition if it terminates.</p>
<p>For example, we can write</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt x\ge 0 \wedge \mathtt z=0 \}} \; 
\mathtt{while \ (x \not = 0 ) \  do \ z:=z+y;  x:= x-1  \ done}  \;
\]</div>
<p>to express what we said above, namely that the we want to execute the program above only in case <span class="math notranslate nohighlight">\(\mathtt x\ge 0\)</span> and <span class="math notranslate nohighlight">\(\mathtt z=0\)</span>.</p>
<p><strong>Notation:</strong> We use mathematical notation in pre and postconditions. For example, we write “=” in <span class="math notranslate nohighlight">\(\{\mathtt x\ge 0 \wedge \mathtt z=0 \}\)</span> to mean equality, not assignment. Program variables are typeset in typewriter font as in <span class="math notranslate nohighlight">\(\mathtt{x,y,z}\)</span>.</p>
<p>What should be the post condition?</p>
<p><strong>Exercise:</strong> A first idea for a postcondition is</p>
<div class="math notranslate nohighlight">
\[
{\{\mathtt x\ge 0 \wedge \mathtt z=0 \}} \; 
\mathtt{while \ (x \not = 0 ) \  do \ z:=z+y;  x:= x-1  \ done}  \;\color{blue}{\{\mathtt{z=x*y}\}}.
\]</div>
<p>What do you think about this? Does it look right? Consider how <span class="math notranslate nohighlight">\(\mathtt x\)</span> changes through the computation.</p>
<p>Answer.<a class="footnote-reference brackets" href="#looksright" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a></p>
</section>
<section id="program-variables-vs-mathematical-variables">
<h2>Program Variables vs Mathematical Variables<a class="headerlink" href="#program-variables-vs-mathematical-variables" title="Link to this heading">#</a></h2>
<p>Our difficulty in finding the correct postcondition can be remedied using the following trick.</p>
<p>While we allow program variables to change during the execution of a program <span class="math notranslate nohighlight">\(\mathtt S\)</span> in</p>
<div class="math notranslate nohighlight">
\[
\{P\}\; \mathtt S\;\{Q\}
\]</div>
<p>we also allow, not in programs, but in the properties <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(Q\)</span>, mathematical variables. This is not surprising, once we had the idea, since we are already using mathematical notation such as <span class="math notranslate nohighlight">\(&gt;,=,\wedge\)</span> etc. And, as in mathematics, there is no assigment-operation that would allow us to change the value of a mathematical variable. So when we write</p>
<div class="math notranslate nohighlight">
\[
\{\ldots n\ldots \}\; \mathtt S\;\{\ldots n\ldots\}
\]</div>
<p>the mathematical variable <span class="math notranslate nohighlight">\(n\)</span> stands for the same value before the execution and after the execution of <span class="math notranslate nohighlight">\(\mathtt S\)</span>.</p>
<p><strong>Question:</strong> Recalling that <span class="math notranslate nohighlight">\(\mathtt y\)</span> is a program variable and that <span class="math notranslate nohighlight">\(n\)</span> is a mathematical variable: What does</p>
<div class="math notranslate nohighlight">
\[
\{\mathtt y = n\}\; \mathtt S\;\{\mathtt y = n\}
\]</div>
<p>express about <span class="math notranslate nohighlight">\(\mathtt S\)</span>? Why does it not express that <span class="math notranslate nohighlight">\(\mathtt y\)</span> cannot change during the execution of <span class="math notranslate nohighlight">\(S\)</span>?</p>
<p><strong>Exercise:</strong> Do the following pre and postconditions</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt z=0 \ \wedge\  \mathtt x =n \}} \; 
\mathtt{while \ (x \not = 0 ) \  do \ z:=z+y;  x:= x-1  \ done}  \;\color{blue}{\{\mathtt{z=\mathit{n}*y}\}}
\]</div>
<p>capture our informal discusions above?</p>
<p><strong>Exercise:</strong> How do you have to change the post and precondition if you  want to drop the precondition <span class="math notranslate nohighlight">\(\color{blue}{\{\mathtt z=0\}}\)</span> and make a statement that holds for arbitrary initial values of <span class="math notranslate nohighlight">\(\mathtt z\)</span>?</p>
<p>See the footnote for a solution.<a class="footnote-reference brackets" href="#invariantznot0" id="id4" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a></p>
</section>
<section id="the-rules-in-detail">
<h2>The Rules in Detail<a class="headerlink" href="#the-rules-in-detail" title="Link to this heading">#</a></h2>
<p>Hoare logic (also known as Floyd-Hoare logic) is a formal system developed by the British computer scientist C. A. R. Hoare, and subsequently refined by Hoare and other researchers. The purpose of the system is to provide a set of logical rules in order to reason about the correctness of computer programs with the rigour of mathematical logic and, therefore, the possibility of delegating such reasoning to a compiler or other verification software tools.</p>
<p>We will describe Hoare Logic for a minimal programming language containg only assignments, conditionals and while-loops. In addition to the rules for the simple language in  Hoare’s original paper, rules for other language constructs have been developed since then by Hoare and many other researchers. There are rules for concurrency, procedures, jumps, and pointers and much more. For example, <a class="reference external" href="https://scholar.google.com/scholar?hl=en&amp;amp;as_sdt=0%2C5&amp;amp;q=%22O%27Hearn%22+%22separation+logic%22+%22facebook%22&amp;amp;btnG=">Separation logic</a> is used by Facebook in verification tools.</p>
<section id="while-loop">
<h3>While-loop<a class="headerlink" href="#while-loop" title="Link to this heading">#</a></h3>
<p>Let us go back to our leading example</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>    while (x != 0 ) do z:=z+y;  x:= x-1 done
</pre></div>
</div>
<p>So let us try to formalise this using pre and postcondition, or, as on says, <em><strong>Hoare triples</strong></em>.</p>
<p><strong>Exercise:</strong> Prove the Hoare triple</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt z = (n-\mathtt x)\cdot\mathtt y\}} \; 
\mathtt{while \ (x \not = 0 ) \  do \ z:=z+y;  x:= x-1  \ done}  \;\color{blue}{\{\mathtt z = (n-\mathtt x)\cdot\mathtt y\}}.
\]</div>
<p><strong>Question:</strong> Why is  <span class="math notranslate nohighlight">\(\color{blue}{\{\mathtt z = (n-\mathtt x)\cdot\mathtt y\}}\)</span> called a loop invariant?</p>
<p><strong>Activity:</strong> Recall that the intended meaning of the while loop is to compute <span class="math notranslate nohighlight">\(\mathtt z = n\cdot\mathtt y\)</span> which we write in form of a Hoare triple as</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt z = 0 \ \wedge \ \mathtt x=n\}} \; 
\mathtt{while \ (x \not = 0 ) \  do \ z:=z+y;  x:= x-1  \ done}  \;\color{blue}{\{\mathtt z = n\cdot\mathtt y\}}.
\]</div>
<p>What reasoning steps are needed to obtain this Hoare triple from the one of the previous exercise?</p>
<p>To carefully explain the answer to this question takes a little effort. So let us first give a short answer:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>        Show that the precondition implies the invariant and
            that the invariant implies the postcondition
</pre></div>
</div>
<p>First, to show that the precondition implies the invariant, is to show that</p>
<div class="math notranslate nohighlight">
\[
\mathtt z = 0 \ \wedge \ \mathtt x=n \ \Longrightarrow \ \mathtt z = (n-\mathtt x)\cdot\mathtt y
\]</div>
<p>This is easy: Just replace in the conclusion <span class="math notranslate nohighlight">\(\mathtt z\)</span> by 0 and <span class="math notranslate nohighlight">\(\mathtt x\)</span> by <span class="math notranslate nohighlight">\(n\)</span> and you find <span class="math notranslate nohighlight">\(0=0\)</span>, which is indeed true. <a class="footnote-reference brackets" href="#equals" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a></p>
<p>Second, to show that the invariant implies the postcondition, is to show that</p>
<div class="math notranslate nohighlight">
\[
\mathtt z = (n-\mathtt x)\cdot\mathtt y \ \Longrightarrow \ \mathtt z = n\cdot\mathtt y
\]</div>
<p>and if you go back to the program you see that this is possible since we know that</p>
<div class="math notranslate nohighlight">
\[
\mathtt x=0
\]</div>
<p>is a postcondition that must always be true after termination of the while-loop.</p>
<p><strong>Exercise:</strong> Explain why. <a class="footnote-reference brackets" href="#xis0" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a></p>
<p>So summarise in symbolic notation what we have done so far, we started out with a rule stating that <span class="math notranslate nohighlight">\(I\)</span> is an invariant</p>
<div class="math notranslate nohighlight">
\[
\frac{\color{blue}{\{I \}}\ \mathtt S\ \color{blue}{\{I\}}}{\color{blue}{\{I \}}\ \mathtt{while}\ B\ \mathtt{do}\ S\ \mathtt{done} \color{blue}{\{ I\}}}
\]</div>
<p>and then modified it to take into account that after termination of the loop we also know “not <span class="math notranslate nohighlight">\(B\)</span>”, that is,</p>
<div class="math notranslate nohighlight">
\[
\frac{\{I \}\ \mathtt S\ \{I\}}{\{I \}\ \mathtt{while}\ B\ \mathtt{do}\ S\ \mathtt{done} \{ \color{blue}{\neg B \,\wedge\,}I\}}
\]</div>
<p>And then we used this rule by showing that the precondition implies <span class="math notranslate nohighlight">\(I\)</span> and that <span class="math notranslate nohighlight">\(\neg B\wedge I\)</span> implies the postcondition.</p>
<p>This last step, which is important to bring into the picture the pre and postconditions that are actually needed for our (partial) correctness assertion, can also be formalised as a rule as follows.</p>
<div class="math notranslate nohighlight">
\[
\color{red}{\frac{P'\Rightarrow P \quad\{P \}\ \mathtt S\ \{Q\} \quad Q\Rightarrow Q'}{\{P' \}\ \mathtt S \  \{Q'\}}}
\]</div>
<p>This rule is our first official rule of Hoare logic. We will see more later and they are all highlighted in red for reference.</p>
<p><strong>Question:</strong> Why does this reasoning not require the precondition <span class="math notranslate nohighlight">\(\color{blue}{\{x\ge 0\}}\)</span>? For what exactly is this precondition needed?</p>
<p>This question has an important answer, so do look up the footnote after thinking about it yourself. <a class="footnote-reference brackets" href="#xge0" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a></p>
<p>Before we formulate the official rule for how to reason with a loop invariant, we need one more adjustment.</p>
<p><strong>Question:</strong> Given the loop</p>
<div class="math notranslate nohighlight">
\[
\mathtt{while \  (x&lt;10) \  do \ x:= x+1  \ done}
\]</div>
<p>what could we use as loop invariant?</p>
<p>It is easy to write down some irrelevant invariants, but which invariant would help us to prove the postcondition <span class="math notranslate nohighlight">\(\color{blue}{\{x=10\}}\)</span>?</p>
<p>A little thought shows that while an <span class="math notranslate nohighlight">\(I\)</span> such that</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{I\}} \; 
\mathtt S  \;\color{blue}{\{I\}}
\]</div>
<p>is obviously an invariant for <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">B</span> <span class="pre">do</span> <span class="pre">S</span> <span class="pre">done</span></code>  , this is more than we need. After all, the invariant only needs to hold if we enter the loop, so it is enough for a <em><strong>loop invariant</strong></em> <span class="math notranslate nohighlight">\(I\)</span> to satisfy</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{I \ \wedge \ \mathtt B\}} \; 
\mathtt{\mathtt S}  \;\color{blue}{\{I\}}. 
\]</div>
<p>To illustrate this idea think about the following.</p>
<p><strong>Exercise:</strong> Consider again</p>
<div class="math notranslate nohighlight">
\[
\mathtt{while \  (x&lt;10) \  do \ x:= x+1  \ done}
\]</div>
<p>and find a loop invariant. Can you conclude from that invariant the postcondition <span class="math notranslate nohighlight">\(\color{blue}{\{x = 10\}}\)</span>?</p>
<p>For a solution see the footnote.<a class="footnote-reference brackets" href="#invariantx10" id="id8" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a></p>
<p>We are now ready to state the Hoare rule for a while loop.</p>
<p>The <em><strong>while rule</strong></em> is as follows.</p>
<div class="math notranslate nohighlight">
\[
\color{red}{\frac{\{I \wedge \mathtt B \}\ \mathtt S\ \{I\}}{\{I \}\ \mathtt{while}\ B\ \mathtt{do}\ S\ \mathtt{done} \{\neg B \wedge I\}}}
\]</div>
<p>Here <span class="math notranslate nohighlight">\(I\)</span> is the <em><strong>loop invariant</strong></em>.</p>
</section>
<section id="making-hoare-logic-compositional">
<h3>Making Hoare Logic Compositional<a class="headerlink" href="#making-hoare-logic-compositional" title="Link to this heading">#</a></h3>
<p>From a practical programming point of view we already learned some important lessons from studying Hoare logic.</p>
<p>For example, we have seen</p>
<ul class="simple">
<li><p>how to separate termination from partial correctness and</p></li>
<li><p>how to prove partial correctness of loops using invariants.</p></li>
</ul>
<p>But there is more to Hoare logic.</p>
<p>We have seen two examples of symbolic rules (see the red rules above) that formalise the way we reasoned about our example programs.</p>
<p>Two big ideas of programming languages are now the following.</p>
<ul class="simple">
<li><p>If we can formalise enough rules needed to reason about programs, then we can build software tools that do reason for us automatically.</p></li>
<li><p>There is hope to find all rules as long as we proceed in a compositional way, that is, “by induction” on the rules that define the programming language.</p></li>
</ul>
<p>In our case, we have a programming language that has assignments, sequential composition, conditionals, and while-loops.</p>
<p>So far we have only seen the rule for while-loops.</p>
<p>In what follows, we will look at rules for the other programming constructions.</p>
</section>
<section id="sequential-composition">
<h3>Sequential Composition<a class="headerlink" href="#sequential-composition" title="Link to this heading">#</a></h3>
<p>The rule of composition applies to sequentially-executed programs
<span class="math notranslate nohighlight">\(\mathtt S\)</span> and <span class="math notranslate nohighlight">\(\mathtt T\)</span>, where <span class="math notranslate nohighlight">\(\mathtt S\)</span> executes prior to <span class="math notranslate nohighlight">\(\mathtt T\)</span> and is written</p>
<div class="math notranslate nohighlight">
\[
\mathtt S;\mathtt T
\]</div>
<p>For example, consider the following two instances of the assignment axiom:</p>
<div class="math notranslate nohighlight">
\[ 
\{ x + 1 = 43\} \ y:=x + 1\ \{y =43 \}
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[ 
\{ y = 43\} \ z:=y\ \{z =43 \}. 
\]</div>
<p>By putting these together, we get:</p>
<div class="math notranslate nohighlight">
\[ 
\{ x + 1 = 43\} \ y:=x + 1; z:= y\ \{z =43 \}
\]</div>
<p>The <strong>rule for composition</strong> of programs is as follows.</p>
<div class="math notranslate nohighlight">
\[
\color{red}{
\frac{\{P\}\ \mathtt S\ \{Q\} \quad\quad \{Q\}\ \mathtt T\ \{R\}}
{\{P\}\ \mathtt S ; \mathtt T\ \{R\}}
}
\]</div>
</section>
<section id="assignment">
<h3>Assignment<a class="headerlink" href="#assignment" title="Link to this heading">#</a></h3>
<p>The assignment instruction is written as</p>
<div class="math notranslate nohighlight">
\[
\mathtt x:=E
\]</div>
<p>and it assigns the value <span class="math notranslate nohighlight">\(E\)</span> to the variable <span class="math notranslate nohighlight">\(\mathtt x\)</span>. For example, we consider a   program consisting of only one instruction</p>
<div class="math notranslate nohighlight">
\[
\mathtt x:= \mathtt y-1
\]</div>
<p>which assigns <span class="math notranslate nohighlight">\(\mathtt y-1\)</span> to the variable <span class="math notranslate nohighlight">\(\mathtt x\)</span>.</p>
<p>Now, suppose we know that <span class="math notranslate nohighlight">\(y\)</span> has value <span class="math notranslate nohighlight">\(10\)</span> before the execution of this instruction. Then, we know that after its execution the value of <span class="math notranslate nohighlight">\(x\)</span> will be <span class="math notranslate nohighlight">\(9\)</span>. This is expressed in Hoare Logic as follows.</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt y = 10 \}} 
\ \ \ \mathtt x:= \mathtt y-1  \ \ \ 
\color{blue}{\{\mathtt x=9  \}}
\]</div>
<p>The predicate <span class="math notranslate nohighlight">\(\mathtt y=10\)</span>  is the precondition and the predicate <span class="math notranslate nohighlight">\(\mathtt x=9\)</span> is the postcondition.</p>
<p>Our predicates could involve more variables. For instance,</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt x&gt;0 \wedge \mathtt x\leq 3 \wedge \mathtt y = 10 \}}
 \ \ \ \mathtt x:= \mathtt y-1  \ \  
\color{blue}{\{\mathtt x=9 \wedge \mathtt y=10 \}} \]</div>
<p>The <em><strong>assignment axiom</strong></em> in Hoare Logic  states that after the assignment any predicate holds for the variable that was previously true for the right-hand side of the assignment:</p>
<div class="math notranslate nohighlight">
\[ 
\color{red}{\{P [\mathtt{exp}\,/\,\mathtt x]  \}
\ \ \ \mathtt x:=\mathtt{exp} \ \ \ 
\{P \}} 
\]</div>
<p>In other words, the post-condition  <span class="math notranslate nohighlight">\(P\)</span> holds after the execution of the  assignment <span class="math notranslate nohighlight">\(\mathtt x:=E\)</span> provided that  <span class="math notranslate nohighlight">\(P [\mathtt{exp}\,/\,\mathtt x]\)</span> holds prior to it.</p>
<p>Suppose now that the program is  the statement</p>
<div class="math notranslate nohighlight">
\[
y:=x + 1
\]</div>
<p>and we want that <span class="math notranslate nohighlight">\(\mathtt y = 43\)</span> after its execution. What are the possible values for <span class="math notranslate nohighlight">\(\mathtt x\)</span> at the beginning of the execution of our program?</p>
<p>Using the  assignment axiom we get that</p>
<div class="math notranslate nohighlight">
\[ 
\color{blue}{\{\mathtt x+1 = 43\}}
\ \ \ \mathtt y:=\mathtt x + 1\ \ \ 
\color{blue}{\{ \mathtt y = 43 \}}
\]</div>
<p>The precondition <span class="math notranslate nohighlight">\(\mathtt x+1 = 43\)</span>  can be simplified to <span class="math notranslate nohighlight">\(\mathtt x = 42\)</span>. Hence,</p>
<div class="math notranslate nohighlight">
\[ 
\color{blue}{\{\mathtt x = 42 \}}
\ \ \ \mathtt y:=\mathtt x + 1 \ \ \ 
\color{blue}{\{ \mathtt y = 43 \}}
\]</div>
<p>Suppose now that our program is the statement</p>
<div class="math notranslate nohighlight">
\[
\mathtt x := \mathtt x + 1
\]</div>
<p>and we want that <span class="math notranslate nohighlight">\(\mathtt x \leq N\)</span> after its execution. Using the assignment axiom we get</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt x + 1 \leq N \}}
\ \ \ \mathtt x := \mathtt x + 1\ \ \ 
\color{blue}{\{\mathtt x \leq N\}} 
\]</div>
<p>Hence,</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt x &lt;  N \}}
\ \ \ \mathtt x := \mathtt x + 1\ \ \ 
\color{blue}{\{\mathtt x \leq N\}} 
\]</div>
<p><strong>Remark:</strong> The assignment axiom proposed by Hoare does not apply when more than one name can refer to the same stored value. For example,</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{ y = 3\}} 
\ \ \ x := 2 \ \ \ 
\color{blue}{\{y = 3 \}}
\]</div>
<p>The above statement is not  true if <span class="math notranslate nohighlight">\(x\)</span>  and <span class="math notranslate nohighlight">\(y\)</span> refer to the same variable, because no precondition can cause y to be 3 after x is set to 2.</p>
</section>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Link to this heading">#</a></h3>
<p>Use the red rules above to show</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{true\}}\ \mathtt{while \  (x&lt;10) \  do \ x:= x+1  \ done}\color{blue}{\{\mathtt x=10\}}
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\color{blue}{\{\mathtt z = m \ \wedge \ \mathtt x=n\}} \; 
\mathtt{while \ (x \not = 0 ) \  do \ z:=z+y;  x:= x-1  \ done}  \;\color{blue}{\{\mathtt z = m + n\cdot\mathtt y\}}.
\]</div>
<p><strong>Remark:</strong> In the second example you need to strengthen the invariant so that it expresses that <span class="math notranslate nohighlight">\(y\)</span> does not change in the loop.</p>
</section>
<section id="if-then-else">
<h3>If-then-else<a class="headerlink" href="#if-then-else" title="Link to this heading">#</a></h3>
<p>Consider the following program.</p>
<div class="math notranslate nohighlight">
\[
\mathtt{if}\ (y&gt;0) \ \mathtt{then}\  x: = y \ \mathtt{else}\ x:= -y 
 \ \mathtt{endif}
\]</div>
<p>We want to show that the above program  calculates the absolute value of <span class="math notranslate nohighlight">\(y\)</span>,
denoted by <span class="math notranslate nohighlight">\(| y |\)</span>, i.e.</p>
<div class="math notranslate nohighlight">
\[
\{true\} \mathtt{if}\ (y&gt;0) \ \mathtt{then}\  x: = y \ \mathtt{else}\ x:= -y 
 \ \mathtt{endif} \{x = |y|\} 
\]</div>
<p>If <span class="math notranslate nohighlight">\(y&gt;0\)</span> then it is clear that <span class="math notranslate nohighlight">\(x=y\)</span>. If not, then <span class="math notranslate nohighlight">\(y \leq 0\)</span>
and then <span class="math notranslate nohighlight">\(x = - y = |y |\)</span>.</p>
<p>Consider the following program.</p>
<div class="math notranslate nohighlight">
\[
\mathtt{if}\ (x \geq y) \ \mathtt{then}\  z:= x  \ \mathtt{else}\ z
:= y 
 \ \mathtt{endif}
\]</div>
<p>We want to show that the above program calculates the maximum of the
two values <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span>, i.e.</p>
<div class="math notranslate nohighlight">
\[
\{true\} \mathtt{if}\ (x \geq y) \ \mathtt{then}\  z:= x  \ \mathtt{else}\ z
:= y 
 \ \mathtt{endif} \{ z = max(x,y) \}
\]</div>
<p>If <span class="math notranslate nohighlight">\(x \geq y\)</span> then <span class="math notranslate nohighlight">\(x\)</span> is the maximum and then <span class="math notranslate nohighlight">\(z = x = max(x,y)\)</span>. If not, then <span class="math notranslate nohighlight">\(x &lt; y\)</span> and <span class="math notranslate nohighlight">\(z = y = max(x,y)\)</span>.</p>
<p>The  <strong>conditional rule</strong> is as follows.</p>
<div class="math notranslate nohighlight">
\[
\color{red}{
\frac{\{B \wedge P\}\ \mathtt S\ \{Q\} \quad\quad \{\neg B \wedge P \}\ \mathtt T\ \{Q\} }
{\{P\}\ \mathtt{if}\ B\ \mathtt{then}\ \mathtt S\ \mathtt{else}\ \mathtt T\ \mathtt{endif}\ \{Q\}}
}
\]</div>
<p>This concludes our explanations of Hoare logic.</p>
</section>
</section>
<section id="homework">
<h2>Homework<a class="headerlink" href="#homework" title="Link to this heading">#</a></h2>
<p>Apply the method of analysis from these notes to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="p">(</span><span class="n">x</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="n">do</span> <span class="n">z</span><span class="o">:=</span><span class="n">z</span><span class="o">*</span><span class="n">y</span><span class="p">;</span>  <span class="n">x</span><span class="o">:=</span> <span class="n">x</span><span class="o">-</span><span class="mi">1</span> <span class="n">done</span>
</pre></div>
</div>
<p>What is the invariant? Indicate the reasoning steps in which you  apply the rules of Hoare logic.</p>
<p>This exercise is very similar to what we have done above (essentially, we use now <code class="docutils literal notranslate"><span class="pre">*</span></code> instead of <code class="docutils literal notranslate"><span class="pre">+</span></code>). If you want to do something more challenging, you can instead also do the next exercise.</p>
</section>
<section id="further-exercises">
<h2>Further Exercises<a class="headerlink" href="#further-exercises" title="Link to this heading">#</a></h2>
<p>Apply the method of analysis to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="k">while</span> <span class="p">(</span><span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">)</span> <span class="n">do</span> <span class="n">t</span><span class="o">:=</span><span class="n">t</span><span class="o">+</span><span class="n">i</span><span class="p">;</span> <span class="n">i</span><span class="o">:=</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="n">done</span>
</pre></div>
</div>
<p>[Hint: <a class="reference external" href="https://en.wikipedia.org/wiki/Triangular_number">Triangular numbers</a>.]</p>
<p>See also <a class="reference external" href="https://hackmd.io/&#64;alexhkurz/rkhVZNzjH">Exercises: Program Verification, Hoare Logic, Loop Invariants</a>.</p>
</section>
<section id="summary-and-outlook">
<h2>Summary and Outlook<a class="headerlink" href="#summary-and-outlook" title="Link to this heading">#</a></h2>
<p>I will first summarise some of the lessons that we learned from studying Hoare logic, lessons that are relevant to programmers and software engineers far beyond the particularities of this specific approach to program correctness.</p>
<p>Then I will briefely look at the history of ideas around “structured programming” which gave rise to Hoare logic and other approaches to program verification.</p>
<section id="id9">
<h3>Hoare Logic<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>… the following summary is currently just a collection of random notes …</p>
<ul class="simple">
<li><p>The following habits can improve the practice of programming</p>
<ul>
<li><p>What are the pre and postconditions of the code I write?</p></li>
<li><p>Should I test them explicitely? Raise an exception if they are violated? Describe them explicitely in comments? Make users of my code aware of them?</p></li>
<li><p>Using software tools that support pre and postcondition in my code.</p></li>
<li><p>Thinking of loop-invariants before implementing my loops.</p></li>
<li><p>Working backwards from postconditions to preconditions: Given that I want to guarantee a postcondition, what are the preconditions and what is the code needed for this? <a class="footnote-reference brackets" href="#fromposttopre" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a></p></li>
</ul>
</li>
<li><p>These programming techniques have formal counterparts, some of which are</p>
<ul>
<li><p>Hoare triples</p></li>
<li><p>loop invariants</p></li>
<li><p>rules of Hoare logic</p></li>
</ul>
</li>
<li><p>Hoare logic is compositional
We have seen that each programming construct corresponds to a rule in Hoare logic for a simple programming language consisting only of assignments, conditionals, sequential composition and while-loops. In principle there is no reason why this approach could not be extended to cover any construct available in any programming language. Not surprisingly, the literature on this topic is vast. For us here, the upshot is that the rules of Hoare logic are compositional in the definition of the syntax of the language.</p></li>
<li><p>Hoare logic is a formal system
While this lecture emphasised how to use invariants to reason about the correctness of while loops, we also hinted at how this reasoning can be formalised.</p></li>
<li><p>Hoare logic can be implemented by software tools that support program design and development
This is a consequence of the previous item. Formal systems can be implemented and then turned into tools.</p></li>
<li><p>Hoare logic as many ramifications for various special purpose situations such as concurrency, memory management, etc</p></li>
</ul>
</section>
<section id="structured-programming">
<h3>Structured Programming<a class="headerlink" href="#structured-programming" title="Link to this heading">#</a></h3>
<p>(this section is being written as an after-thought and was not part of the semester)</p>
<p>Early programming close to the machine relies on jumps as a basic mechanism to control flow. Accordingly, early higher level languages such as Fortran had a corresponding <span class="math notranslate nohighlight">\(\texttt{goto}\)</span> statement. Goto’s lend themselves to the writing of “unstructured” code that is difficult to read and debug, but was considered a necessary ingredient.</p>
<p>In 1966, the article <a class="reference external" href="https://scholar.google.com/scholar?hl=en&amp;amp;as_sdt=0%2C5&amp;amp;q=Flow+diagrams%2C+turing+machines+and+languages+with+only+two+formation+rules&amp;amp;btnG=">Flow diagrams, turing machines and languages with only two formation rules</a> by Boehm and  showed that jumps (gotos) are not needed and any program can be written with just three controle structures: sequential composition, conditional and iteration. This was an important result at the time as it suggested that the complex control structures (typically based on gotos, later fiving rise to so-called spaghetti code) that plagued programming at the time were not necessary.</p>
</section>
</section>
<section id="historical-references">
<h2>Historical References<a class="headerlink" href="#historical-references" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Reynolds: <a class="reference external" href="https://kilthub.cmu.edu/ndownloader/files/12102656">The Craft of Programming</a>. 1981.</p></li>
</ul>
<p>This is one of the first textbooks teaching verification of programs. I find it still interesting today …</p>
<ul class="simple">
<li><p>…</p></li>
</ul>
</section>
<section id="further-reading">
<h2>Further Reading<a class="headerlink" href="#further-reading" title="Link to this heading">#</a></h2>
<section id="formal-verification">
<h3>Formal Verification<a class="headerlink" href="#formal-verification" title="Link to this heading">#</a></h3>
<p>We have seen that the rules of Hoare logic can be formalised in symbolic notation. It should therefore should be possible to implement software engineering tools that automate reasoning about programs.</p>
<p>To get a taste of how verification is done in real world programming applications, have a look at the blogs by David Crocker about <em>Verifying loops in C and C++</em>, <a class="reference external" href="https://critical.eschertech.com/2010/03/22/verifying-loops-in-c/">part 1</a> and <a class="reference external" href="https://critical.eschertech.com/2010/03/29/verifying-loops-part-2/">part 2</a> and <a class="reference external" href="https://critical.eschertech.com/2010/03/31/verifying-loops-proving-termination/">part 3</a>. There is also a very short <a class="reference external" href="https://critical.eschertech.com/about/">introduction to software verification</a>.</p>
<hr class="footnotes docutils" />
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="invariantwhile2" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>Let us think about it.</p>
<p>Each time the program goes through the loop, <code class="docutils literal notranslate"><span class="pre">x</span></code> will be decremented. How often does it happen? This again depends on <code class="docutils literal notranslate"><span class="pre">x</span></code>.</p>
<p><em><strong>The aim is to find a reasoning principle that frees us from tracking how often we go through a loop.</strong></em></p>
<p>Here it is actually easy to see that we go <code class="docutils literal notranslate"><span class="pre">x</span></code> times through the loop (if <code class="docutils literal notranslate"><span class="pre">x</span></code> is not negative). But in more complicated examples there may not be a formula that allows us to caclulate the number of times we go through a loop from the available data.</p>
<p>(This follows from the halting problem.)</p>
<p>So we would like to decouple the question “how often do we go through the loop?” (termination) from the question of correctness … which is then called <em><strong>partial correctness</strong></em>, or more precisely, correctness under the assumption of termination.</p>
<p>Does this sound impossible?</p>
<p>Remember our lecture about <a class="reference external" href="https://hackmd.io/&#64;alexhkurz/BkMoUhXvD">invariants</a>?</p>
<p>Can you spot an invariant? A property that remains unchanged while going throuth the loop?</p>
<p>Hint: Invent a notation that allows to distinguish the value of a program variable before and after the execution of some code. (There are different ways of doing this.)</p>
<p>Can you conclude from the invariant what the result of the computation is?</p>
<p>After answering the questions yourself, you can check with my solutions below.</p>
</aside>
<aside class="footnote brackets" id="invariantwhile" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Let us make a table of an execution. We assume here that the program variables are initialised as follows: <code class="docutils literal notranslate"><span class="pre">x</span></code> is 100, <code class="docutils literal notranslate"><span class="pre">y</span></code> is 2 and <code class="docutils literal notranslate"><span class="pre">z</span></code> is 0. <code class="docutils literal notranslate"><span class="pre">t</span></code> counts how often the body of the loop was executed. (We will later see how to generalize to aribtrary input <code class="docutils literal notranslate"><span class="pre">x,y,z</span></code>.)</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head text-center"><p><code class="docutils literal notranslate"><span class="pre">t</span></code></p></th>
<th class="head text-center"><p><code class="docutils literal notranslate"><span class="pre">x</span></code></p></th>
<th class="head text-center"><p><code class="docutils literal notranslate"><span class="pre">y</span></code></p></th>
<th class="head text-center"><p><code class="docutils literal notranslate"><span class="pre">z</span></code></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-center"><p>0</p></td>
<td class="text-center"><p>100</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>0</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>1</p></td>
<td class="text-center"><p>99</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>2</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>2</p></td>
<td class="text-center"><p>98</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>4</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>…</p></td>
<td class="text-center"><p>…</p></td>
<td class="text-center"><p>…</p></td>
<td class="text-center"><p>…</p></td>
</tr>
<tr class="row-even"><td class="text-center"><p>99</p></td>
<td class="text-center"><p>1</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>198</p></td>
</tr>
<tr class="row-odd"><td class="text-center"><p>100</p></td>
<td class="text-center"><p>0</p></td>
<td class="text-center"><p>2</p></td>
<td class="text-center"><p>200</p></td>
</tr>
</tbody>
</table>
</div>
<p>How can we be sure that we found the correct numbers to fill in after the dots? The answer is that these numbers satisfy invariants, namely</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>t + x = 100
z = t * y
</pre></div>
</div>
<p>With a bit of algebra we can now find an invariant that only consists of program variables</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>z = (100 - x) * y
</pre></div>
</div>
<p>This is an invariant. We will see below how to make this independent of particular values such as <code class="docutils literal notranslate"><span class="pre">100</span></code>.</p>
</aside>
<aside class="footnote brackets" id="looksright" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>The problem with <span class="math notranslate nohighlight">\(\color{blue}{\{\mathtt{z=x*y}\}}\)</span> is that it only gives us what we want if we take for <span class="math notranslate nohighlight">\(\mathtt x\)</span> the value of <span class="math notranslate nohighlight">\(\mathtt x\)</span> <em>before</em> the computation and for <span class="math notranslate nohighlight">\(\mathtt z\)</span> the value of <span class="math notranslate nohighlight">\(\mathtt z\)</span> <em>after</em> the computation. On the other hand, if we take for both variables their values after the computation, as we should (why?), the condition <span class="math notranslate nohighlight">\(\color{blue}{\{\mathtt{z=x*y}\}}\)</span> is false (for almost all initial values of the variables).</p>
</aside>
<aside class="footnote brackets" id="invariantznot0" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id4">4</a><span class="fn-bracket">]</span></span>
<div class="math notranslate nohighlight">
\[\color{blue}{\{\mathtt x=n \ \wedge\  \mathtt z=m \ \wedge\  \mathtt y =k \}} \; 
\mathtt{while \ (x \not = 0 ) \  do \ z:=z+y;  x:= x-1  \ done}  \;\color{blue}{\{\mathtt{z=n+m*k}\}}. \]</div>
</aside>
<aside class="footnote brackets" id="equals" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id5">5</a><span class="fn-bracket">]</span></span>
<p>The rule of logic that allows us to replace equals by equals is often called the “congruence rule” of equational reasoning.</p>
</aside>
<aside class="footnote brackets" id="xis0" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">6</a><span class="fn-bracket">]</span></span>
<p>The condition <span class="math notranslate nohighlight">\(\mathtt B\)</span> that forces to execute the loop is in our example <code class="docutils literal notranslate"><span class="pre">x!=0</span></code>, that is, <span class="math notranslate nohighlight">\(\neg(x=0)\)</span>. Therefore <span class="math notranslate nohighlight">\(\neg\mathtt B\)</span> is <span class="math notranslate nohighlight">\(\neg\neg(x=0)\)</span>, which is <span class="math notranslate nohighlight">\(x=0\)</span>.</p>
</aside>
<aside class="footnote brackets" id="xge0" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">7</a><span class="fn-bracket">]</span></span>
<p>Our first observation was that the precondition <span class="math notranslate nohighlight">\(\{x\ge 0\}\)</span> is needed for correctness. Why is it not needed in the proof of the Hoare triple? The reason is that Hoare triples only concern what is called <strong>partial correctness</strong>, that is, correctness under the assumption of termination. Indeed, <span class="math notranslate nohighlight">\(\{x\ge 0\}\)</span> is only needed in our example to argue for termination.</p>
</aside>
<aside class="footnote brackets" id="invariantx10" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id8">8</a><span class="fn-bracket">]</span></span>
<p><span class="math notranslate nohighlight">\(\color{blue}{x\le 10}\)</span> is a loop invariant.</p>
</aside>
<aside class="footnote brackets" id="fromposttopre" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">9</a><span class="fn-bracket">]</span></span>
<p>Note that this goes in the opposite direction of our usual thinking about code, which is operational and proceeds from an initial state and works forward from there.</p>
</aside>
</aside>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="appendix-puzzles.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Resources on Puzzles</p>
      </div>
    </a>
    <a class="right-next"
       href="how-to-create-a-jupyter-book.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">How to Create a Jupyter Book</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">Example</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preconditions-postconditions">Preconditions … Postconditions …</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#program-variables-vs-mathematical-variables">Program Variables vs Mathematical Variables</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-rules-in-detail">The Rules in Detail</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#while-loop">While-loop</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#making-hoare-logic-compositional">Making Hoare Logic Compositional</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sequential-composition">Sequential Composition</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#assignment">Assignment</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise">Exercise</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#if-then-else">If-then-else</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#homework">Homework</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-exercises">Further Exercises</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-and-outlook">Summary and Outlook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">Hoare Logic</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#structured-programming">Structured Programming</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#historical-references">Historical References</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#further-reading">Further Reading</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#formal-verification">Formal Verification</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By CPSC 510
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>