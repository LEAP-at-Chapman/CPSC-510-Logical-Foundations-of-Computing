
<!DOCTYPE html>


<html lang="en" data-content_root="../../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>What is it? &#8212; Logical Foundations of Computing</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'playground/sudoku/node_modules/async-mutex/README';</script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../../intro.html">
  
  
  
  
  
  
    <p class="title logo__title">Logical Foundations of Computing</p>
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Logics and Their Software Tools</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../content/1-propositional-logic.html">Propositional Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/2-satsolving.html">SAT solving with MiniSat</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/3-logic-programming.html">Logic Programming with Prolog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/4-constraint-solving.html">Constraint Programming with MiniZinc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/5-smt-solving.html">SMT Solving and Z3</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/6-modal-logic.html">Modal Logic</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/7-temporal-logic.html">Temporal Logic with Spin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/8-epistemic-logic.html">Epistemic Logic with SMCDEL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/9-hoare-logic.html">Hoare Logic with Dafny</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/10-higher-order-logic.html">Higher-Order Logic with Isabelle/HOL</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/11-dependent-types.html">Dependent Type Theory with Lean</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../content/puzzles.html">Resources on Puzzles</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Appendix: On Jupyter Books</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../../content/how-to-create-a-jupyter-book.html">How to Create a Jupyter Book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/markdown.html">Markdown Files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/notebooks.html">Content with notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../content/markdown-notebooks.html">Notebooks with MyST Markdown</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/LEAP-at-Chapman/CPSC-510-Logical-Foundations-of-Computing" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/LEAP-at-Chapman/CPSC-510-Logical-Foundations-of-Computing/issues/new?title=Issue%20on%20page%20%2Fplayground/sudoku/node_modules/async-mutex/README.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../../_sources/playground/sudoku/node_modules/async-mutex/README.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>What is it?</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">What is it?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutex">Mutex</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#semaphore">Semaphore</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-it">How to use it?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing">Importing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutex-api">Mutex API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating">Creating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronized-code-execution">Synchronized code execution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-locking-releasing">Manual locking / releasing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-whether-the-mutex-is-locked">Checking whether the mutex is locked</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cancelling-pending-locks">Cancelling pending locks.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#waiting-until-the-mutex-is-available">Waiting until the mutex is available</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#semaphore-api">Semaphore API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Creating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Synchronized code execution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Manual locking / releasing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-whether-the-semaphore-is-locked">Checking whether the semaphore is locked</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Cancelling pending locks.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#waiting-until-the-semaphore-is-available">Waiting until the semaphore is available</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limiting-the-time-waiting-for-a-mutex-or-semaphore-to-become-available">Limiting the time waiting for a mutex or semaphore to become available</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#failing-early-if-the-mutex-or-semaphore-is-not-available">Failing early if the mutex or semaphore is not available</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#license">License</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><a class="reference external" href="https://github.com/DirtyHairy/async-mutex/actions?query=workflow%3A%22Build+and+Tests%22"><img alt="Build status" src="https://github.com/DirtyHairy/async-mutex/workflows/Build%20and%20Tests/badge.svg" /></a>
<a class="reference external" href="https://badge.fury.io/js/async-mutex"><img alt="NPM version" src="https://badge.fury.io/js/async-mutex.svg" /></a>
<a class="reference external" href="https://coveralls.io/github/DirtyHairy/async-mutex?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/DirtyHairy/async-mutex/badge.svg?branch=master" /></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="what-is-it">
<h1>What is it?<a class="headerlink" href="#what-is-it" title="Link to this heading">#</a></h1>
<p>This package implements primitives for synchronizing asynchronous operations in
Javascript.</p>
<section id="mutex">
<h2>Mutex<a class="headerlink" href="#mutex" title="Link to this heading">#</a></h2>
<p>The term “mutex” usually refers to a data structure used to synchronize
concurrent processes running on different threads. For example, before accessing
a non-threadsafe resource, a thread will lock the mutex. This is guaranteed
to block the thread until no other thread holds a lock on the mutex and thus
enforces exclusive access to the resource. Once the operation is complete, the
thread releases the lock, allowing other threads to acquire a lock and access the
resource.</p>
<p>While Javascript is strictly single-threaded, the asynchronous nature of its
execution model allows for race conditions that require similar synchronization
primitives. Consider for example a library communicating with a web worker that
needs to exchange several subsequent messages with the worker in order to achieve
a task. As these messages are exchanged in an asynchronous manner, it is perfectly
possible that the library is called again during this process. Depending on the
way state is handled during the async process, this will lead to race conditions
that are hard to fix and even harder to track down.</p>
<p>This library solves the problem by applying the concept of mutexes to Javascript.
Locking the mutex will return a promise that resolves once the mutex becomes
available. Once the async process is complete (usually taking multiple
spins of the event loop), a callback supplied to the caller is called in order
to release the mutex, allowing the next scheduled worker to execute.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="semaphore">
<h1>Semaphore<a class="headerlink" href="#semaphore" title="Link to this heading">#</a></h1>
<p>Imagine a situation where you need to control access to several instances of
a shared resource. For example, you might want to distribute images between several
worker processes that perform transformations, or you might want to create a web
crawler that performs a defined number of requests in parallel.</p>
<p>A semaphore is a data structure that is initialized to a positive integer value and that
can be locked multiple times.
As long as the semaphore value is positive, locking it will return the current value
and the locking process will continue execution immediately; the semaphore will
be decremented upon locking. Releasing the lock will increment the semaphore again.</p>
<p>Once the semaphore has reached zero, the next process that attempts to acquire a lock
will be suspended until another process releases its lock and this increments the semaphore
again.</p>
<p>This library provides a semaphore implementation for Javascript that is similar to the
mutex implementation described above.</p>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="how-to-use-it">
<h1>How to use it?<a class="headerlink" href="#how-to-use-it" title="Link to this heading">#</a></h1>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">#</a></h2>
<p>You can install the library into your project via npm</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>npm install async-mutex
</pre></div>
</div>
<p>The library is written in TypeScript and will work in any environment that
supports ES5, ES6 promises and <code class="docutils literal notranslate"><span class="pre">Array.isArray</span></code>. On ancient browsers,
a shim can be used (e.g. <a class="reference external" href="https://github.com/zloirock/core-js">core-js</a>).
No external typings are required for using this library with
TypeScript (version &gt;= 2).</p>
<p>Starting with Node 12.16 and 13.7, native ES6 style imports are supported.</p>
<p><strong>WARNING:</strong> Node 13 versions &lt; 13.2.0 fail to import this package correctly.
Node 12 and earlier are fine, as are newer versions of Node 13.</p>
</section>
<section id="importing">
<h2>Importing<a class="headerlink" href="#importing" title="Link to this heading">#</a></h2>
<p><strong>CommonJS:</strong></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span><span class="w"> </span><span class="nx">Mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;async-mutex&#39;</span><span class="p">).</span><span class="nx">Mutex</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">Semaphore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;async-mutex&#39;</span><span class="p">).</span><span class="nx">Semaphore</span><span class="p">;</span>
<span class="kd">var</span><span class="w"> </span><span class="nx">withTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">require</span><span class="p">(</span><span class="s1">&#39;async-mutex&#39;</span><span class="p">).</span><span class="nx">withTimeout</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>ES6:</strong></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">Mutex</span><span class="p">,</span><span class="w"> </span><span class="nx">Semaphore</span><span class="p">,</span><span class="w"> </span><span class="nx">withTimeout</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p><strong>TypeScript:</strong></p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">Mutex</span><span class="p">,</span><span class="w"> </span><span class="nx">MutexInterface</span><span class="p">,</span><span class="w"> </span><span class="nx">Semaphore</span><span class="p">,</span><span class="w"> </span><span class="nx">SemaphoreInterface</span><span class="p">,</span><span class="w"> </span><span class="nx">withTimeout</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>With the latest version of Node, native ES6 style imports are supported.</p>
</section>
<section id="mutex-api">
<h2>Mutex API<a class="headerlink" href="#mutex-api" title="Link to this heading">#</a></h2>
<section id="creating">
<h3>Creating<a class="headerlink" href="#creating" title="Link to this heading">#</a></h3>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Mutex</span><span class="p">();</span>
</pre></div>
</div>
<p>Create a new mutex.</p>
</section>
<section id="synchronized-code-execution">
<h3>Synchronized code execution<a class="headerlink" href="#synchronized-code-execution" title="Link to this heading">#</a></h3>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">mutex</span>
<span class="w">    </span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">await</span><span class="w"> </span><span class="nx">mutex</span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> schedules the supplied callback to be run once the mutex is unlocked.
The function may return a promise. Once the promise is resolved or rejected (or immediately after
execution if an immediate value was returned),
the mutex is released. <code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> returns a promise that adopts the state of the function result.</p>
<p>The mutex is released and the result rejected if an exception occurs during execution
if the callback.</p>
</section>
<section id="manual-locking-releasing">
<h3>Manual locking / releasing<a class="headerlink" href="#manual-locking-releasing" title="Link to this heading">#</a></h3>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">mutex</span>
<span class="w">    </span><span class="p">.</span><span class="nx">acquire</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">release</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>

<span class="w">        </span><span class="nx">release</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">release</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">mutex</span><span class="p">.</span><span class="nx">acquire</span><span class="p">();</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">release</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">acquire</span></code> returns an (ES6) promise that will resolve as soon as the mutex is
available. The promise resolves with a function <code class="docutils literal notranslate"><span class="pre">release</span></code> that
must be called once the mutex should be released again.</p>
<p><strong>IMPORTANT:</strong> Failure to call <code class="docutils literal notranslate"><span class="pre">release</span></code> will hold the mutex locked and will
likely deadlock the application. Make sure to call <code class="docutils literal notranslate"><span class="pre">release</span></code> under all circumstances
and handle exceptions accordingly.</p>
<p><code class="docutils literal notranslate"><span class="pre">acquire</span></code> / <code class="docutils literal notranslate"><span class="pre">release</span></code> should be considered a low level API. In most situations,
<code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> will be a better choice that automatically takes care of releasing
the mutex once a block of code has executed exclusively.</p>
</section>
<section id="checking-whether-the-mutex-is-locked">
<h3>Checking whether the mutex is locked<a class="headerlink" href="#checking-whether-the-mutex-is-locked" title="Link to this heading">#</a></h3>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">mutex</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">();</span>
</pre></div>
</div>
</section>
<section id="cancelling-pending-locks">
<h3>Cancelling pending locks.<a class="headerlink" href="#cancelling-pending-locks" title="Link to this heading">#</a></h3>
<p>Pending locks can be cancelled by calling <code class="docutils literal notranslate"><span class="pre">cancel()</span></code> on the mutex. This will reject
all pending locks with <code class="docutils literal notranslate"><span class="pre">E_CANCELED</span></code>:</p>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">E_CANCELED</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>

<span class="nx">mutex</span>
<span class="w">    </span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">E_CANCELED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ...</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">E_CANCELED</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>

<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">mutex</span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">E_CANCELED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This works with <code class="docutils literal notranslate"><span class="pre">acquire</span></code>, too:
if <code class="docutils literal notranslate"><span class="pre">acquire</span></code> is used for locking, the resulting promise will reject with <code class="docutils literal notranslate"><span class="pre">E_CANCELED</span></code>.</p>
<p>The error that is thrown can be customized by passing a different error to the <code class="docutils literal notranslate"><span class="pre">Mutex</span></code>
constructor:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Mutex</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;fancy custom error&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Note that while all pending locks are cancelled, a currently held lock will not be
revoked. In consequence, the mutex may not be available even after <code class="docutils literal notranslate"><span class="pre">cancel()</span></code> has been called.</p>
</section>
<section id="waiting-until-the-mutex-is-available">
<h3>Waiting until the mutex is available<a class="headerlink" href="#waiting-until-the-mutex-is-available" title="Link to this heading">#</a></h3>
<p>You can wait until the mutex is available without locking it by calling <code class="docutils literal notranslate"><span class="pre">waitForUnlock()</span></code>.
This will return a promise that resolve once the mutex can be acquired again. This operation
will not lock the mutex, and there is no gurantee that the mutex will still be available
once a async barrier has been encountered.</p>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">mutex</span>
<span class="w">    </span><span class="p">.</span><span class="nx">waitForUnlock</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>Async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">await</span><span class="w"> </span><span class="nx">mutex</span><span class="p">.</span><span class="nx">waitForUnlock</span><span class="p">();</span>
<span class="c1">// ...</span>
</pre></div>
</div>
</section>
</section>
<section id="semaphore-api">
<h2>Semaphore API<a class="headerlink" href="#semaphore-api" title="Link to this heading">#</a></h2>
<section id="id1">
<h3>Creating<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">semaphore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Semaphore</span><span class="p">(</span><span class="nx">initialValue</span><span class="p">);</span>
</pre></div>
</div>
<p>Creates a new semaphore. <code class="docutils literal notranslate"><span class="pre">initialValue</span></code> is a positive integer that defines the
initial value of the semaphore (aka the maximum number of concurrent consumers).</p>
</section>
<section id="id2">
<h3>Synchronized code execution<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">semaphore</span>
<span class="w">    </span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">await</span><span class="w"> </span><span class="nx">semaphore</span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(</span><span class="k">async</span><span class="w"> </span><span class="p">(</span><span class="nx">value</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">});</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> schedules the supplied callback to be run once the semaphore is available.
The callback will receive the current value of the semaphore as its argument.
The function may return a promise. Once the promise is resolved or rejected (or immediately after
execution if an immediate value was returned),
the semaphore is released. <code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> returns a promise that adopts the state of the function result.</p>
<p>The semaphore is released and the result rejected if an exception occurs during execution
of the callback.</p>
</section>
<section id="id3">
<h3>Manual locking / releasing<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">semaphore</span>
<span class="w">    </span><span class="p">.</span><span class="nx">acquire</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">([</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">release</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>

<span class="w">        </span><span class="nx">release</span><span class="p">();</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="p">[</span><span class="nx">value</span><span class="p">,</span><span class="w"> </span><span class="nx">release</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">semaphore</span><span class="p">.</span><span class="nx">acquire</span><span class="p">();</span>
<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// ...</span>
<span class="p">}</span><span class="w"> </span><span class="k">finally</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">release</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">acquire</span></code> returns an (ES6) promise that will resolve as soon as the semaphore is
available. The promise resolves to an array with the
first entry being the current value of the semaphore, and the second value a
function that must be called to release the semaphore once the critical operation
has completed.</p>
<p><strong>IMPORTANT:</strong> Failure to call <code class="docutils literal notranslate"><span class="pre">release</span></code> will hold the semaphore locked and will
likely deadlock the application. Make sure to call <code class="docutils literal notranslate"><span class="pre">release</span></code> under all circumstances
and handle exceptions accordingly.</p>
<p><code class="docutils literal notranslate"><span class="pre">acquire</span></code> / <code class="docutils literal notranslate"><span class="pre">release</span></code> should be considered a low level API. In most situations,
<code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> will be a better choice that automatically takes care of releasing
the mutex once a block of code has executed exclusively.</p>
</section>
<section id="checking-whether-the-semaphore-is-locked">
<h3>Checking whether the semaphore is locked<a class="headerlink" href="#checking-whether-the-semaphore-is-locked" title="Link to this heading">#</a></h3>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">semaphore</span><span class="p">.</span><span class="nx">isLocked</span><span class="p">();</span>
</pre></div>
</div>
<p>The semaphore is considered to be locked if it has a value of zero.</p>
</section>
<section id="id4">
<h3>Cancelling pending locks.<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>Pending locks can be cancelled by calling <code class="docutils literal notranslate"><span class="pre">cancel()</span></code> on the sempahore. This will reject
all pending locks with <code class="docutils literal notranslate"><span class="pre">E_CANCELED</span></code>:</p>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">E_CANCELED</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>

<span class="nx">semaphore</span>
<span class="w">    </span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">E_CANCELED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ...</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">E_CANCELED</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>

<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">semaphore</span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">E_CANCELED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This works with <code class="docutils literal notranslate"><span class="pre">aquire</span></code>, too:
if <code class="docutils literal notranslate"><span class="pre">acquire</span></code> is used for locking, the resulting promise will reject with <code class="docutils literal notranslate"><span class="pre">E_CANCELED</span></code>.</p>
<p>The error that is thrown can be customized by passing a different error to the <code class="docutils literal notranslate"><span class="pre">Semaphore</span></code>
constructor:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">semaphore</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Semaphore</span><span class="p">(</span><span class="mf">2</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;fancy custom error&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>Note that while all pending locks are cancelled, any currently held locks will not be
revoked. In consequence, the semaphore may not be available even after <code class="docutils literal notranslate"><span class="pre">cancel()</span></code> has been called.</p>
</section>
<section id="waiting-until-the-semaphore-is-available">
<h3>Waiting until the semaphore is available<a class="headerlink" href="#waiting-until-the-semaphore-is-available" title="Link to this heading">#</a></h3>
<p>You can wait until the semaphore is available without locking it by calling <code class="docutils literal notranslate"><span class="pre">waitForUnlock()</span></code>.
This will return a promise that resolve once the semaphore can be acquired again. This operation
will not lock the semaphore, and there is no gurantee that the semaphore will still be available
once a async barrier has been encountered.</p>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="nx">semaphore</span>
<span class="w">    </span><span class="p">.</span><span class="nx">waitForUnlock</span><span class="p">()</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>Async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">await</span><span class="w"> </span><span class="nx">semaphore</span><span class="p">.</span><span class="nx">waitForUnlock</span><span class="p">();</span>
<span class="c1">// ...</span>
</pre></div>
</div>
</section>
</section>
<section id="limiting-the-time-waiting-for-a-mutex-or-semaphore-to-become-available">
<h2>Limiting the time waiting for a mutex or semaphore to become available<a class="headerlink" href="#limiting-the-time-waiting-for-a-mutex-or-semaphore-to-become-available" title="Link to this heading">#</a></h2>
<p>Sometimes it is desirable to limit the time a program waits for a mutex or
semaphore to become available. The <code class="docutils literal notranslate"><span class="pre">withTimeout</span></code> decorator can be applied
to both semaphores and mutexes and changes the behavior of <code class="docutils literal notranslate"><span class="pre">acquire</span></code> and
<code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> accordingly.</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">withTimeout</span><span class="p">,</span><span class="w"> </span><span class="nx">E_TIMEOUT</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>

<span class="kd">const</span><span class="w"> </span><span class="nx">mutexWithTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">withTimeout</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Mutex</span><span class="p">(),</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">semaphoreWithTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">withTimeout</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Semaphore</span><span class="p">(</span><span class="mf">5</span><span class="p">),</span><span class="w"> </span><span class="mf">100</span><span class="p">);</span>
</pre></div>
</div>
<p>The API of the decorated mutex or semaphore is unchanged.</p>
<p>The second argument of <code class="docutils literal notranslate"><span class="pre">withTimeout</span></code> is the timeout in milliseconds. After the
timeout is exceeded, the promise returned by <code class="docutils literal notranslate"><span class="pre">acquire</span></code> and <code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> will
reject with <code class="docutils literal notranslate"><span class="pre">E_TIMEOUT</span></code>. The latter will not run the provided callback in case
of an timeout.</p>
<p>The third argument of <code class="docutils literal notranslate"><span class="pre">withTimeout</span></code> is optional and can be used to
customize the error with which the promise is rejected.</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="kd">const</span><span class="w"> </span><span class="nx">mutexWithTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">withTimeout</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Mutex</span><span class="p">(),</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;new fancy error&#39;</span><span class="p">));</span>
<span class="kd">const</span><span class="w"> </span><span class="nx">semaphoreWithTimeout</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">withTimeout</span><span class="p">(</span><span class="ow">new</span><span class="w"> </span><span class="nx">Semaphore</span><span class="p">(</span><span class="mf">5</span><span class="p">),</span><span class="w"> </span><span class="mf">100</span><span class="p">,</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="ne">Error</span><span class="p">(</span><span class="s1">&#39;new fancy error&#39;</span><span class="p">));</span>
</pre></div>
</div>
<section id="failing-early-if-the-mutex-or-semaphore-is-not-available">
<h3>Failing early if the mutex or semaphore is not available<a class="headerlink" href="#failing-early-if-the-mutex-or-semaphore-is-not-available" title="Link to this heading">#</a></h3>
<p>A shortcut exists for the case where you do not want to wait for a lock to
be available at all. The <code class="docutils literal notranslate"><span class="pre">tryAcquire</span></code> decorator can be applied to both mutexes
and semaphores and changes the behavior of <code class="docutils literal notranslate"><span class="pre">acquire</span></code> and <code class="docutils literal notranslate"><span class="pre">runExclusive</span></code> to
immediately throw <code class="docutils literal notranslate"><span class="pre">E_ALREADY_LOCKED</span></code> if the mutex is not available.</p>
<p>Promise style:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">tryAcquire</span><span class="p">,</span><span class="w"> </span><span class="nx">E_ALREADY_LOCKED</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>

<span class="nx">tryAcquire</span><span class="p">(</span><span class="nx">semaphoreOrMutex</span><span class="p">)</span>
<span class="w">    </span><span class="p">.</span><span class="nx">runExclusive</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">})</span>
<span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">E_ALREADY_LOCKED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="c1">// ...</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">});</span>
</pre></div>
</div>
<p>async/await:</p>
<div class="highlight-typescript notranslate"><div class="highlight"><pre><span></span><span class="k">import</span><span class="w"> </span><span class="p">{</span><span class="nx">tryAcquire</span><span class="p">,</span><span class="w"> </span><span class="nx">E_ALREADY_LOCKED</span><span class="p">}</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;async-mutex&#39;</span><span class="p">;</span>

<span class="k">try</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">await</span><span class="w"> </span><span class="nx">tryAcquire</span><span class="p">(</span><span class="nx">semaphoreOrMutex</span><span class="p">).</span><span class="nx">runExclusive</span><span class="p">(()</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">});</span>
<span class="p">}</span><span class="w"> </span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="nx">E_ALREADY_LOCKED</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="c1">// ...</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Again, the error can be customized by providing a custom error as second argument to
<code class="docutils literal notranslate"><span class="pre">tryAcquire</span></code>.</p>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="license">
<h1>License<a class="headerlink" href="#license" title="Link to this heading">#</a></h1>
<p>Feel free to use this library under the conditions of the MIT license.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./playground/sudoku/node_modules/async-mutex"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">What is it?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutex">Mutex</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#semaphore">Semaphore</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-use-it">How to use it?</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation">Installation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#importing">Importing</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mutex-api">Mutex API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#creating">Creating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#synchronized-code-execution">Synchronized code execution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-locking-releasing">Manual locking / releasing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-whether-the-mutex-is-locked">Checking whether the mutex is locked</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cancelling-pending-locks">Cancelling pending locks.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#waiting-until-the-mutex-is-available">Waiting until the mutex is available</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#semaphore-api">Semaphore API</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Creating</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Synchronized code execution</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Manual locking / releasing</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-whether-the-semaphore-is-locked">Checking whether the semaphore is locked</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Cancelling pending locks.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#waiting-until-the-semaphore-is-available">Waiting until the semaphore is available</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limiting-the-time-waiting-for-a-mutex-or-semaphore-to-become-available">Limiting the time waiting for a mutex or semaphore to become available</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#failing-early-if-the-mutex-or-semaphore-is-not-available">Failing early if the mutex or semaphore is not available</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#license">License</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By CPSC 510
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>